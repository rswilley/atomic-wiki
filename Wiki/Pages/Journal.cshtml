@page
@model JournalModel
@{
    ViewData["Title"] = "Journal";
}

@section Styles {
    <style>
        .journal-entry {
            border-left: 3px solid transparent;
            transition: box-shadow 0.15s ease, transform 0.15s ease, border-left-color 0.15s ease;
        }

        .journal-entry:hover {
            border-left-color: #0d6efd;
            box-shadow: 0 0.5rem 1rem rgba(0,0,0,0.06);
            transform: translateY(-2px);
        }
    </style>
}

<h1 class="h4 mb-3">Journal</h1>

<!-- Filters / controls -->
<section class="mb-3">
    <form method="get" class="row g-2 align-items-end">
        <div class="col-12 col-md-4">
            <label class="form-label small text-muted">Search</label>
            <input name="q"
                   value="@Model.Query"
                   class="form-control form-control-sm"
                   placeholder="Search journal..." />
        </div>

        <div class="col-6 col-md-3">
            <label class="form-label small text-muted">From</label>
            <input type="date"
                   name="from"
                   value="@(Model.From?.ToString("yyyy-MM-dd"))"
                   class="form-control form-control-sm" />
        </div>

        <div class="col-6 col-md-3">
            <label class="form-label small text-muted">To</label>
            <input type="date"
                   name="to"
                   value="@(Model.To?.ToString("yyyy-MM-dd"))"
                   class="form-control form-control-sm" />
        </div>

        <div class="col-12 col-md-2 d-grid">
            <button type="submit" class="btn btn-sm btn-outline-secondary">
                Apply
            </button>
        </div>
    </form>
</section>

<!-- Journal entries grouped by day -->
<section class="journal-list">
    @if (Model.Groups.Any())
    {
        @foreach (var group in Model.Groups)
        {
            <div class="mb-4">
                <!-- Date heading -->
                <div class="d-flex justify-content-between align-items-center mb-1">
                    <div>
                        <div class="fw-semibold">
                            @group.Date.ToString("yyyy-MM-dd")
                        </div>
                        <div class="small text-muted">
                            @group.Date.ToString("dddd")
                        </div>
                    </div>

                    <div class="small text-muted d-none d-sm-inline">
                        @group.Entries.Count @((group.Entries.Count == 1) ? "entry" : "entries")
                    </div>
                </div>

                <!-- Entries for that day -->
                <div class="row g-2">
                    @* On mobile: full width; on md+: 2 per row *@
                    @foreach (var entry in group.Entries)
                    {
                        <div class="col-12 col-md-6">
                            <article class="card journal-entry h-100">
                                <div class="card-body py-2 px-3 d-flex flex-column">
                                    <div class="d-flex justify-content-between align-items-start mb-1">
                                        <div class="small text-muted">
                                            @entry.Time?.ToString(@"hh\:mm") ?? "--:--"
                                        </div>

                                        @if (entry.Tags?.Any() == true)
                                        {
                                            <div class="d-none d-sm-flex flex-wrap gap-1 small ms-2">
                                                @foreach (var tag in entry.Tags)
                                                {
                                                    <span class="badge bg-light text-dark border">@tag</span>
                                                }
                                            </div>
                                        }
                                    </div>

                                    @if (!string.IsNullOrWhiteSpace(entry.Title))
                                    {
                                        <h2 class="h6 mb-1">
                                            <a asp-page="/JournalEntry"
                                               asp-route-id="@entry.Id"
                                               class="text-decoration-none">
                                                @entry.Title
                                            </a>
                                        </h2>
                                    }

                                    @if (!string.IsNullOrWhiteSpace(entry.Snippet))
                                    {
                                        <p class="small text-muted mb-0">
                                            @entry.Snippet
                                        </p>
                                    }
                                </div>
                            </article>
                        </div>
                    }
                </div>
            </div>
        }
    }
    else
    {
        <p class="text-muted small">
            No journal entries found in this range.
            <a asp-page="/NewJournalEntry">Write a new entry</a>.
        </p>
    }
</section>
